<!doctype html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="generator" content="Docusaurus v2.0.0-alpha.50">
<link rel="apple-touch-icon" sizes="180x180" href="/img/apple-touch-icon.png">
<link rel="icon" sizes="32x32" href="/img/favicon-32x32.png">
<link rel="icon" sizes="16x16" href="/img/favicon-16x16.png">
<link rel="manifest" href="/site.webmanifest">
<meta name="msapplication-TileColor" content="#000000">
<meta name="theme-color" content="#ffffff">
<script>const style=document.createElement("style");style.type="text/css",style.textContent=".menu .menu__list .menu__list-item.menu__list-item--collapsed .menu__list{height:0;overflow:hidden}.menu .menu__list .menu__link.menu__link--sublist:after{visibility:visible}.menu .menu__list .menu__list-item.menu__list-item--collapsed .menu__link--sublist:after{visibility:visible}",document.getElementsByTagName("head")[0].appendChild(style)</script>

<title data-react-helmet="true">Promises &amp; Async | learning-notes</title>

<meta data-react-helmet="true" name="twitter:card" content="summary_large_image"><meta data-react-helmet="true" property="og:title" content="Promises &amp; Async | learning-notes"><meta data-react-helmet="true" name="description" content="All things related to Promises and asynchronous programming"><meta data-react-helmet="true" property="og:description" content="All things related to Promises and asynchronous programming"><meta data-react-helmet="true" property="og:url" content="https://mehdisaffar.github.io/learning-notes/learning-notes/javascript/promises">

<link data-react-helmet="true" rel="shortcut icon" href="/learning-notes/favicon.ico">


<link rel="stylesheet" href="/learning-notes/styles.850997e5.css">


<link rel="preload" href="/learning-notes/styles.18f9376d.js" as="script">

<link rel="preload" href="/learning-notes/runtime~main.345eba0c.js" as="script">

<link rel="preload" href="/learning-notes/main.02ab9ff7.js" as="script">

<link rel="preload" href="/learning-notes/common.9821af57.js" as="script">

<link rel="preload" href="/learning-notes/2.b61a99b5.js" as="script">

<link rel="preload" href="/learning-notes/14.4b091162.js" as="script">

<link rel="preload" href="/learning-notes/039a453e.0b0bdb4e.js" as="script">

<link rel="preload" href="/learning-notes/17896441.523d4b05.js" as="script">

<link rel="preload" href="/learning-notes/a6a88a80.ffdd782b.js" as="script">

</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=window.matchMedia("(prefers-color-scheme: dark)"),n=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();null!==n?t(n):e.matches&&t("dark")}()</script>
<svg style="display: none;"><desc>Font Awesome Free 5.13.0 by @fontawesome - https://fontawesome.com
            License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License)</desc>
            <symbol id="external-link-alt" viewBox="0 0 512 512">
                <path d="M432,320H400a16,16,0,0,0-16,16V448H64V128H208a16,16,0,0,0,16-16V80a16,16,0,0,0-16-16H48A48,48,0,0,0,0,112V464a48,48,0,0,0,48,48H400a48,48,0,0,0,48-48V336A16,16,0,0,0,432,320ZM488,0h-128c-21.37,0-32.05,25.91-17,41l35.73,35.73L135,320.37a24,24,0,0,0,0,34L157.67,377a24,24,0,0,0,34,0L435.28,133.32,471,169c15,15,41,4.5,41-17V24A24,24,0,0,0,488,0Z"></path>
            </symbol>
            <symbol id="github" viewBox="0 0 496 512">
                <path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"></path>
            </symbol></svg>
<div id="__docusaurus">
<nav class="navbar navbar--light navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><div aria-label="Navigation bar toggle" class="navbar__toggle" role="button" tabindex="0"><svg xmlns="http://www.w3.org/2000/svg" width="30" height="30" viewBox="0 0 30 30" role="img" focusable="false"><title>Menu</title><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></div><a aria-current="page" class="navbar__brand active" href="/learning-notes/"><img class="navbar__logo" src="/learning-notes/img/mehdisaffar.svg" alt="mehdisaffar logo"><strong class="navbar__title">learning-notes</strong></a><a target="_blank" rel="noopener noreferrer" href="https://mehdisaffar.github.io/learning-notes" class="navbar__item navbar__link">GitHub</a></div><div class="navbar__items navbar__items--right"><a target="_blank" rel="noopener noreferrer" href="https://mehdisaffar.github.io/learning-notes" class="header-github-link navbar__item navbar__link" aria-label="GitHub repository"></a><div class="react-toggle react-toggle--disabled displayOnlyInLargeViewport_1gtM"><div class="react-toggle-track"><div class="react-toggle-track-check"><span class="toggle_keGJ moon_1gwN"></span></div><div class="react-toggle-track-x"><span class="toggle_keGJ sun_3CPA"></span></div></div><div class="react-toggle-thumb"></div><input type="checkbox" disabled="" aria-label="Dark mode toggle" class="react-toggle-screenreader-only"></div><div class="navbar__search"><span aria-label="expand searchbar" role="button" class="search-icon" tabindex="0"></span><input type="search" id="search_input_react" placeholder="Search" aria-label="Search" class="navbar__search-input search-bar"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div><div class="navbar-sidebar"><div class="navbar-sidebar__brand"><a aria-current="page" class="navbar__brand active" href="/learning-notes/"><img class="navbar__logo" src="/learning-notes/img/mehdisaffar.svg" alt="mehdisaffar logo"><strong class="navbar__title">learning-notes</strong></a></div><div class="navbar-sidebar__items"><div class="menu"><ul class="menu__list"><li class="menu__list-item"><a target="_blank" rel="noopener noreferrer" href="https://mehdisaffar.github.io/learning-notes" class="menu__link">GitHub</a></li><li class="menu__list-item"><a target="_blank" rel="noopener noreferrer" href="https://mehdisaffar.github.io/learning-notes" class="header-github-link navbar__item navbar__link" aria-label="GitHub repository"></a></li></ul></div></div></div></nav><div class="main-wrapper"><div class="docPage_1kjD"><div class="docSidebarContainer_1cYp"><div class="sidebar_1kLs"><div class="menu menu--responsive menu_w2sC"><button aria-label="Open Menu" aria-haspopup="true" class="button button--secondary button--sm menu__button" type="button"><svg aria-label="Menu" class="sidebarMenuIcon_2vk4" xmlns="http://www.w3.org/2000/svg" height="24" width="24" viewBox="0 0 32 32" role="img" focusable="false"><title>Menu</title><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><ul class="menu__list"><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">About</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" href="/learning-notes/about/about">About these notes</a></li><li class="menu__list-item"><a class="menu__link" href="/learning-notes/about/contributing">Contributing</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Backend</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" href="/learning-notes/backend/background-jobs">Background jobs</a></li></ul></li><li class="menu__list-item"><a class="menu__link menu__link--sublist menu__link--active" href="#!">Javascript</a><ul class="menu__list"><li class="menu__list-item"><a aria-current="page" class="menu__link menu__link--active" href="/learning-notes/javascript/promises">Promises &amp; Async</a></li></ul></li></ul></div></div></div><main class="docMainContainer_FFX1"><div class="padding-vert--lg"><div class="container"><div class="row"><div class="col docItemCol_2GOA"><div class="docItemContainer_2cwg"><article><header><h1 class="docTitle_1vWb">Promises &amp; Async</h1></header><div class="markdown"><p><em>All things related to Promises and asynchronous programming</em></p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_ZqCz" id="single-or-multi-threaded"></a><a aria-hidden="true" tabindex="-1" class="hash-link" href="#single-or-multi-threaded" title="Direct link to heading">#</a>Single or multi-threaded?</h2><p>The main Javascript execution context is single-threaded, NOT multithreaded. The underlying engine however can be (and I think IS) multithreaded.</p><p>The event loop merely gives the illusion of things happening in parallel, however at any point in time only a single piece of code runs. </p><p>If we take the example of an async with say 3 <code>await</code> points, we can roughly think of that function&#x27;s code as being broken down to 4 &quot;contiguous pieces of synchronous code&quot;, which we can call Tasks.</p><p>Each task runs in one go until completion. When we hit an await, the function takes a &quot;break&quot; and the engine chooses another task to run. </p><p>So it is akin to having multiple processes running on a single core, and the OS schedule execution. However, what is important to remember, is that Javascript tasks run until completion, while the OS runs until pre-emption.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_ZqCz" id="defer-pattern-or-antipattern"></a><a aria-hidden="true" tabindex="-1" class="hash-link" href="#defer-pattern-or-antipattern" title="Direct link to heading">#</a>Defer pattern (or antipattern?)</h2><p>It is possible to create a Promise that can be resolved &quot;externally&quot; and &quot;manually&quot; - that is, from outside the <code>(resolve, reject) =&gt; {...}</code> callback.</p><p>It looks like this:</p><div class="mdxCodeBlock_iHAB"><div class="codeBlockContent_32p_"><button type="button" aria-label="Copy code to clipboard" class="copyButton_1BYj">Copy</button><div tabindex="0" class="prism-code language-javascript codeBlock_19pQ"><div class="codeBlockLines_2n9r" style="color:#393A34;background-color:#f6f8fa"><div class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">// https://lea.verou.me/2016/12/resolve-promises-externally-with-this-one-weird-trick/</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#393A34"><span class="token plain">module</span><span class="token punctuation" style="color:#393A34">.</span><span class="token method-variable function-variable method function property-access" style="color:#d73a49">exports</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">function</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">defer</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> res</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">let</span><span class="token plain"> rej</span></div><div class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> promise </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">new</span><span class="token plain"> </span><span class="token class-name">Promise</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">(</span><span class="token parameter">resolve</span><span class="token parameter punctuation" style="color:#393A34">,</span><span class="token parameter"> reject</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token arrow operator" style="color:#393A34">=&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain">        res </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> resolve</span></div><div class="token-line" style="color:#393A34"><span class="token plain">        rej </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> reject</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span></div><div class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    promise</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">resolve</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> res</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    promise</span><span class="token punctuation" style="color:#393A34">.</span><span class="token property-access">reject</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> rej</span></div><div class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> promise</span></div><div class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span></div></div></div></div></div><p>This is called a Deferred pattern and is actually discouraged from use when using Promises, however there might a time it is needed so it is good to know.</p><div class="github-footer"><p><svg class="embedded-fa-icon"><use href="#github"></use></svg> <strong><a href="https://github.com/MehdiSaffar/learning-notes/blob/master/javascript/promises.md" target="_blank" rel="nofollow noopener noreferrer">View this note on GitHub <svg class="embedded-fa-icon"><use href="#external-link-alt"></use></svg></a></strong></p><p><strong>Last modified:</strong> 2021-10-11</p></div></div></article><div class="margin-vert--lg"><nav class="pagination-nav"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/learning-notes/backend/background-jobs"><div class="pagination-nav__link--sublabel">Previous</div><div class="pagination-nav__link--label">« Background jobs</div></a></div><div class="pagination-nav__item pagination-nav__item--next"></div></nav></div></div></div><div class="col col--3"><div class="tableOfContents_TbNY"><ul class="contents contents__left-border"><li><a href="#single-or-multi-threaded" class="contents__link">Single or multi-threaded?</a></li><li><a href="#defer-pattern-or-antipattern" class="contents__link">Defer pattern (or antipattern?)</a></li></ul></div></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container"><div class="text--center"><div>This work is licensed under a <a href="http://creativecommons.org/licenses/by/4.0/" rel="nofollow">Creative Commons Attribution 4.0 International
License</a>.</div></div></div></footer>
</div>

<script src="/learning-notes/styles.18f9376d.js"></script>

<script src="/learning-notes/runtime~main.345eba0c.js"></script>

<script src="/learning-notes/main.02ab9ff7.js"></script>

<script src="/learning-notes/common.9821af57.js"></script>

<script src="/learning-notes/2.b61a99b5.js"></script>

<script src="/learning-notes/14.4b091162.js"></script>

<script src="/learning-notes/039a453e.0b0bdb4e.js"></script>

<script src="/learning-notes/17896441.523d4b05.js"></script>

<script src="/learning-notes/a6a88a80.ffdd782b.js"></script>

<script>window.goatcounter={no_events:!0},window.addEventListener("click",t=>{if(!window.goatcounter.count)return;if(!t.target)return;const e=t.target.getAttribute("href");!e||e.startsWith("http")||e.startsWith("#")||setTimeout(()=>{window.goatcounter.count()})})</script>
<script data-goatcounter="https://learning-notes.goatcounter.com/count" async src="//gc.zgo.at/count.js"></script>
</body>
</html>